<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
        <nav class="level is-mobile">
            <p class="level-item has-text-centered">
              <a class="link is-info" href="http://cs.newpaltz.edu/~schmidtm6/TutoringWebsite/index.html">Home</a>
            </p>
            <p class="level-item has-text-centered">
              <a class="link is-info" href="http://cs.newpaltz.edu/~schmidtm6/TutoringWebsite/menu.html">Menu </a>
            </p>
            <p class="level-item has-text-centered">
              <img src="https://www.brentshea.com/wp-content/uploads/2014/09/logo2.jpg" alt="The Math Tutor Logo" style="height: 100px;">
            </p>
            <p class="level-item has-text-centered">
              <a class="link is-info" href="http://cs.newpaltz.edu/~schmidtm6/TutoringWebsite/appointments.html">Appointments</a>
            </p>
            <p class="level-item has-text-centered">
              <a class="link is-info has-text-success-dark" href="http://cs.newpaltz.edu/~schmidtm6/TutoringWebsite/contact.html">Contact</a>
            </p>
          </nav>
        </head>
        <body>          
          <?php
              require "contactSubmission.php";
              // define variables and set to empty values
              $fullName = $phoneNumber = $email = $subject = $message = $prefContact = "";
              $nameErr = $phoneOrEmailErr = $subjErr = $messageErr = "";

              if ($_SERVER["REQUEST_METHOD"] == "POST") {
                  if (empty($_POST["fullName"])) {
                      $nameErr = "Full name is required";
                    } else {
                      $fullName = test_input($_POST["fullName"]);
                      // check if name only contains letters and whitespace
                      if (!preg_match("/^[a-zA-Z ]*$/",$fullName)) {
                          $nameErr = "Only letters and white space allowed"; 
                      }
                    }
                  if (empty($_POST["phoneNumber"])&& empty($_POST["email"])) {
                      $phoneOrEmailErr = "Phone and/or Email is required";
                    } else {
                      $phoneNumber = test_input($_POST["phoneNumber"]);
                      if(!preg_match("/^[0-9]{3}-[0-9]{4}-[0-9]{4}$/", $phoneNumber)) {
                          // $phone format is invalid
                          $phoneOrEmailErr = "Invalid format of phone/email input";
                        }
                      $email = test_input($_POST["email"]);
                        // check if e-mail address is well-formed
                        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
                              $phoneOrEmailErr = "Invalid format of phone/email input"; 
                          }
                    }
                  if ($_POST["subject"] = "Select Option") {
                      $subjErr = "Subject is required";
                    } else {
                      $subject = test_input($_POST["subject"]);

                    } 
                    if (empty($_POST["message"])) {
                      $messageErr = "A quick message about your request is required";
                    } else {
                      $message = test_input($_POST["message"]);
                      if (!preg_match("/^[a-zA-Z ]*$/",$message)) {
                          $messageErr = "Only letters and white space allowed"; 
                      }
                    }     
                    if (empty($_POST["prefContact"])) {
                      $prefContact = "";
                    } else {
                      $prefContact = test_input($_POST["prefContact"]);
                    }
              }  

              function test_input($data) {
                $data = trim($data);
                $data = stripslashes($data);
                $data = htmlspecialchars($data);
                return $data;
              }
            ?>  
        <section>
            <h1 class="title">Contact Us!</h1>
            <h2 class="subtitle">Fill out the below form, and we will get back to you as soon as possible.</h2>
        </section>
        <form>
        <section>
          <form method="post" action="contactSubmission.php">
            <div class="field">
            <label class="label">Full Name</label>
            <div class="control">
              <input class="input" type="text" placeholder="Ex. John Smith" name="name">
            </div>
          </div>
          
          <div class="field">
            <label class="label">Phone Number</label>
            <div class="control ">
              <input class="input is-success" type="text" placeholder="Ex. 8005555555" name="phoneNumber">
            </div>
          </div>
          
          <div class="field">
            <label class="label">Email</label>
            <div class="control">
              <input class="input is-danger" type="email" placeholder="Ex. me@aim.com" name="email">
            </div>
          </div>
          
          <div class="field">
            <label class="label">Subject</label>
            <div class="control">
              <div class="select" placeholder="Select Subject" name="subject">
                <select name = "subject">
                  <option selected>Select Option</option>
                  <option>Intro to Proof</option>
                  <option>College Algebra</option>
                  <option>Pre-Calculus</option>
                  <option>Calculus I</option>
                  <option>Calculus II</option>
                  <option>Foundations of Algebra</option>
                  <option>Applied Math I</option>
                  <option>Linear Algebra</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="field">
            <label class="label">Message</label>
            <div class="control">
              <textarea class="textarea" placeholder="Ex. Hi, I need help with my assignment tomorrow. I am free from 3pm - 4pm." name="message"></textarea>
            </div>
          </div>
          
          <div class="field">
            <div class="control">
            <label class="label">Preferred method of Contact</label>    
              <label class="radio">
                <input type="radio" name="prefContact">
                Email
            </label>
              <label class="radio">
                <input type="radio" name="prefContact">
                Phone
              </label>
            </div>
          </div>
          
          <div class="field is-grouped">
            <div class="control">
              <button class="button is-link">Submit</button>
            </div>
            <div class="control">
              <button class="button is-link is-light">Cancel</button>
            </div>
          </div>
        </section> 
        </form>

    </body>
    <footer>
        <footer class="footer">
            <div class="content has-text-centered">
              <p>
                Code by <a href="https://www.linkedin.com/in/meganschmidt23/">Megan Schmidt</a>.
              </p>
            </div>  
        </footer> 
    </footer>